/**
* @license
* Copyright 2020 Dynatrace LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
 */

package customprocessmonitoringrule

import (
	"github.com/dynatrace-oss/terraform-provider-dynatrace/terraform/hcl"
	"github.com/hashicorp/terraform-plugin-sdk/v2/helper/schema"
)

type Condition struct {
	EnvVar   *string           `json:"envVar,omitempty"` // supported only with OneAgent 1.167+
	Item     AgentItemName     `json:"item"`             // Possible Values: `CLOUD_FOUNDRY_APPLICATION_ID`, `KUBERNETES_CONTAINERNAME`, `AWS_ECR_ACCOUNT_ID`, `DECLARATIVE_ID`, `MSSQL_INSTANCE_NAME`, `SPRINGBOOT_STARTUP_CLASS`, `ORACLE_SID`, `RUXIT_NODE_ID`, `WEBSPHERE_CELL_NAME`, `WEBSPHERE_LIBERTY_SERVER_NAME`, `SPRINGBOOT_PROFILE_NAME`, `DOTNET_COMMAND_PATH`, `IIB_EXECUTION_GROUP_NAME`, `COLDFUSION_JVM_CONFIG_FILE`, `DOTNET_COMMAND`, `PG_ID_CALC_INPUT_KEY_LINKAGE`, `JAVA_JAR_FILE`, `PHP_CLI_WORKING_DIR`, `COMMAND_LINE_ARGS`, `WEBLOGIC_HOME`, `CONTAINER_ID`, `IBM_IMS_MPR`, `JAVA_MAIN_CLASS`, `APACHE_CONFIG_PATH`, `AWS_ECR_REGION`, `JBOSS_MODE`, `GLASSFISH_INSTANCE_NAME`, `ELASTIC_SEARCH_CLUSTER_NAME`, `AWS_LAMBDA_FUNCTION_NAME`, `APACHE_SPARK_MASTER_IP_ADDRESS`, `IIB_BROKER_NAME`, `IBM_CICS_IMS_APPLID`, `AWS_REGION`, `CLOUD_FOUNDRY_APP_NAME`, `IBM_CICS_IMS_JOBNAME`, `IIS_APP_POOL`, `KUBERNETES_BASEPODNAME`, `HYBRIS_CONFIG_DIR`, `HYBRIS_BIN_DIR`, `TIPCO_BUSINESSWORKS_PROPERTY_FILE`, `IBM_IMS_CONTROL`, `SERVICE_NAME`, `JAVA_JAR_PATH`, `EQUINOX_CONFIG_PATH`, `AWS_ECS_CLUSTER`, `RUXIT_CLUSTER_ID`, `WEBLOGIC_DOMAIN_NAME`, `KUBERNETES_PODUID`, `JBOSS_SERVER_NAME`, `TIPCO_BUSINESSWORKS_PROPERTY_FILE_PATH`, `TIBCO_BUSINESSWORKS_CE_VERSION`, `KUBERNETES_NAMESPACE`, `IIS_ROLE_NAME`, `IBM_CTG_NAME`, `SOFTWAREAG_PRODUCTPROPNAME`, `EXE_NAME`, `GLASSFISH_DOMAIN_NAME`, `ASP_NET_CORE_APPLICATION_PATH`, `CATALINA_HOME`, `TIBCO_BUSINESSWORKS_DOMAIN_NAME`, `GAE_INSTANCE`, `TIBCO_BUSINESSWORKS_APP_SPACE_NAME`, `AWS_ECS_CONTAINERNAME`, `CONTAINER_NAME`, `GAE_SERVICE`, `WEBLOGIC_CLUSTER_NAME`, `VARNISH_INSTANCE_NAME`, `CLOUD_FOUNDRY_SPACE_NAME`, `SPRINGBOOT_APP_NAME`, `WEBSPHERE_CLUSTER_NAME`, `NODEJS_APP_NAME`, `WEBSPHERE_NODE_NAME`, `IBM_IMS_CONNECT`, `JBOSS_HOME`, `SOFTWAREAG_INSTALL_ROOT`, `IBM_CICS_REGION`, `CLOUD_FOUNDRY_INSTANCE_INDEX`, `CLOUD_FOUNDRY_SPACE_ID`, `NODEJS_APP_BASE_DIR`, `AWS_ECS_REVISION`, `CONTAINER_IMAGE_VERSION`, `PHP_CLI_SCRIPT_PATH`, `AWS_ECS_FAMILY`, `UNKNOWN`, `NODEJS_SCRIPT_NAME`, `TIBCO_BUSINESSWORKS_HOME`, `TIBCO_BUSINESSWORKS_APP_NODE_NAME`, `KUBERNETES_FULLPODNAME`, `HYBRIS_DATA_DIR`, `WEBSPHERE_SERVER_NAME`, `CATALINA_BASE`, `CONTAINER_IMAGE_NAME`, `WEBLOGIC_NAME`, `GOOGLE_CLOUD_PROJECT`, `EXE_PATH`, `IBM_IMS_SOAP_GW_NAME`, `TIBCO_BUSINESSWORKS_CE_APP_NAME`, `ELASTIC_SEARCH_NODE_NAME`
	Operator ConditionOperator `json:"operator"`         // Possible Values: `STARTS`, `EXISTS`, `NOT_STARTS`, `EQUALS`, `NOT_CONTAINS`, `NOT_EXISTS`, `ENDS`, `NOT_ENDS`, `NOT_EQUALS`, `CONTAINS`
	Value    *string           `json:"value,omitempty"`  // Condition value
}

func (me *Condition) Schema() map[string]*schema.Schema {
	return map[string]*schema.Schema{
		"env_var": {
			Type:        schema.TypeString,
			Description: "supported only with OneAgent 1.167+",
			Optional:    true,
		},
		"item": {
			Type:        schema.TypeString,
			Description: "Possible Values: `CLOUD_FOUNDRY_APPLICATION_ID`, `KUBERNETES_CONTAINERNAME`, `AWS_ECR_ACCOUNT_ID`, `DECLARATIVE_ID`, `MSSQL_INSTANCE_NAME`, `SPRINGBOOT_STARTUP_CLASS`, `ORACLE_SID`, `RUXIT_NODE_ID`, `WEBSPHERE_CELL_NAME`, `WEBSPHERE_LIBERTY_SERVER_NAME`, `SPRINGBOOT_PROFILE_NAME`, `DOTNET_COMMAND_PATH`, `IIB_EXECUTION_GROUP_NAME`, `COLDFUSION_JVM_CONFIG_FILE`, `DOTNET_COMMAND`, `PG_ID_CALC_INPUT_KEY_LINKAGE`, `JAVA_JAR_FILE`, `PHP_CLI_WORKING_DIR`, `COMMAND_LINE_ARGS`, `WEBLOGIC_HOME`, `CONTAINER_ID`, `IBM_IMS_MPR`, `JAVA_MAIN_CLASS`, `APACHE_CONFIG_PATH`, `AWS_ECR_REGION`, `JBOSS_MODE`, `GLASSFISH_INSTANCE_NAME`, `ELASTIC_SEARCH_CLUSTER_NAME`, `AWS_LAMBDA_FUNCTION_NAME`, `APACHE_SPARK_MASTER_IP_ADDRESS`, `IIB_BROKER_NAME`, `IBM_CICS_IMS_APPLID`, `AWS_REGION`, `CLOUD_FOUNDRY_APP_NAME`, `IBM_CICS_IMS_JOBNAME`, `IIS_APP_POOL`, `KUBERNETES_BASEPODNAME`, `HYBRIS_CONFIG_DIR`, `HYBRIS_BIN_DIR`, `TIPCO_BUSINESSWORKS_PROPERTY_FILE`, `IBM_IMS_CONTROL`, `SERVICE_NAME`, `JAVA_JAR_PATH`, `EQUINOX_CONFIG_PATH`, `AWS_ECS_CLUSTER`, `RUXIT_CLUSTER_ID`, `WEBLOGIC_DOMAIN_NAME`, `KUBERNETES_PODUID`, `JBOSS_SERVER_NAME`, `TIPCO_BUSINESSWORKS_PROPERTY_FILE_PATH`, `TIBCO_BUSINESSWORKS_CE_VERSION`, `KUBERNETES_NAMESPACE`, `IIS_ROLE_NAME`, `IBM_CTG_NAME`, `SOFTWAREAG_PRODUCTPROPNAME`, `EXE_NAME`, `GLASSFISH_DOMAIN_NAME`, `ASP_NET_CORE_APPLICATION_PATH`, `CATALINA_HOME`, `TIBCO_BUSINESSWORKS_DOMAIN_NAME`, `GAE_INSTANCE`, `TIBCO_BUSINESSWORKS_APP_SPACE_NAME`, `AWS_ECS_CONTAINERNAME`, `CONTAINER_NAME`, `GAE_SERVICE`, `WEBLOGIC_CLUSTER_NAME`, `VARNISH_INSTANCE_NAME`, `CLOUD_FOUNDRY_SPACE_NAME`, `SPRINGBOOT_APP_NAME`, `WEBSPHERE_CLUSTER_NAME`, `NODEJS_APP_NAME`, `WEBSPHERE_NODE_NAME`, `IBM_IMS_CONNECT`, `JBOSS_HOME`, `SOFTWAREAG_INSTALL_ROOT`, `IBM_CICS_REGION`, `CLOUD_FOUNDRY_INSTANCE_INDEX`, `CLOUD_FOUNDRY_SPACE_ID`, `NODEJS_APP_BASE_DIR`, `AWS_ECS_REVISION`, `CONTAINER_IMAGE_VERSION`, `PHP_CLI_SCRIPT_PATH`, `AWS_ECS_FAMILY`, `UNKNOWN`, `NODEJS_SCRIPT_NAME`, `TIBCO_BUSINESSWORKS_HOME`, `TIBCO_BUSINESSWORKS_APP_NODE_NAME`, `KUBERNETES_FULLPODNAME`, `HYBRIS_DATA_DIR`, `WEBSPHERE_SERVER_NAME`, `CATALINA_BASE`, `CONTAINER_IMAGE_NAME`, `WEBLOGIC_NAME`, `GOOGLE_CLOUD_PROJECT`, `EXE_PATH`, `IBM_IMS_SOAP_GW_NAME`, `TIBCO_BUSINESSWORKS_CE_APP_NAME`, `ELASTIC_SEARCH_NODE_NAME`",
			Required:    true,
		},
		"operator": {
			Type:        schema.TypeString,
			Description: "Possible Values: `STARTS`, `EXISTS`, `NOT_STARTS`, `EQUALS`, `NOT_CONTAINS`, `NOT_EXISTS`, `ENDS`, `NOT_ENDS`, `NOT_EQUALS`, `CONTAINS`",
			Required:    true,
		},
		"value": {
			Type:        schema.TypeString,
			Description: "Condition value",
			Optional:    true,
		},
	}
}

func (me *Condition) MarshalHCL(properties hcl.Properties) error {
	return properties.EncodeAll(map[string]any{
		"env_var":  me.EnvVar,
		"item":     me.Item,
		"operator": me.Operator,
		"value":    me.Value,
	})
}

func (me *Condition) UnmarshalHCL(decoder hcl.Decoder) error {
	return decoder.DecodeAll(map[string]any{
		"env_var":  &me.EnvVar,
		"item":     &me.Item,
		"operator": &me.Operator,
		"value":    &me.Value,
	})
}
